# Version de docker-composer souhait√©e
version : "3.7"

services :

    app_symfony :
        container_name: my_app_app_symfony
        build : ./
        ports :
            - 8080:80
        volumes :
            - ./:/var/www/html
        networks:
            - frontend
            - backend
        #links :
        #    - bdd:bdd
        environment:
            MYSQL_HOST : bdd
            MYSQL_DATABASE: app_symfony
            MYSQL_USER : root
            MYSQL_PASSWORD : root

    composer :
        container_name: my_app_composer
        image : composer:latest
        ports :
            - 8081:80
        networks:
            - backend
        volumes :
            - "hotfolder_composer:/usr/bin/"


    blackfire :
        container_name: blackfire
        image : blackfire/blackfire
        restart: always
        ports :
            - 8707
        environment:
            BLACKFIRE_LOG_LEVEL: 4
            BLACKFIRE_SERVER_ID: bd9faad6-74b9-4ace-86b6-b03d920f29ad
            BLACKFIRE_SERVER_TOKEN: db34c1968bc10417cc244a0e0bc3bbdcf653a737770473c0632e4b9f556324ab
            BLACKFIRE_CLIENT_ID: eb78ead5-7a73-4fc0-8aa7-4ddff21ac709
            BLACKFIRE_CLIENT_TOKEN: 76744ff09313636b7b790628ceded921aace653dac9ea24a18c71c08fd7cbfc7
        links:
           - app_symfony
        networks:
           - backend
        volumes:
           - "hotfolder_benchmark:/usr/bin/"
           - ./logs/blackfire:/tmp/
    #integration :
    #    build : ./docker/jenkins
    #    ports :
    #       - 8084:8080
    #       - 50000:50000
    #    volumes :
    #       - hotfolder_jenkins:/var/jenkins_home
    #    links :
    #       - php_apache

    bdd :
        container_name: my_app_bdd
        build : ./docker/mariadb
        restart : unless-stopped
        ports :
            - 3306:3306
        labels:
            com.symfony.server.service-prefix: 'DATABASE'
        volumes :
            - "./docker/mariadb/bdd:/var/lib/mysql"
        networks:
            - backend
        environment :
            MYSQL_ROOT_HOST : '%'
            MYSQL_ROOT_USER : root
            MYSQL_ROOT_PASSWORD : root

    phpMyAdmin :
        container_name: my_app_phpMyAdmin
        image : phpmyadmin/phpmyadmin:5.0
        ports :
            - 8082:80
        links :
           - bdd:bdd
        environment :
            PMA_HOST: bdd
            MYSQL_ROOT_PASSWORD: root
        networks:
            - backend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge

volumes:
    hotfolder_composer:
    #hotfolder_jenkins:
    hotfolder_benchmark: